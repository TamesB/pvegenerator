{% extends "layout_syn.html" %}

{% load semanticui %}
{% load static %}
{% load custom_tags %}

{% block menu %}
{% if request.user.type_user == 'SOG' %}
{% include 'Menu.html' with type='manager' %}
{% elif request.user.type_user == 'SB' %}
{% include 'Menu.html' with type='beheerder' %}
{% elif request.user.type_user == 'SD' %}
{% include 'Menu.html' with type='derde' %}
{% else %}
{% include 'Menu.html' with type='beheerder' %}
{% endif %}
{% endblock %}

{% block main %}
<form class="opmerking_form" action="{% url 'plusopmerking_syn' project.id %}" method="POST" enctype="multipart/form-data">
{% csrf_token %}

<div class="general_title"><img src="{% static 'syntrus/img/accountsderden.png'%}" class="title_img"></img><p><input type="submit" class="submit_button" value="Opslaan"></input><input type="button" class="{{ progress }}" disabled onClick="javascript:location.href='#';" value="Freeze opmerkingen ({{ aantal_opmerkingen_gedaan }} / {{ items|length }})"></input></p></div>
<ul class="list">
  {% for message in messages %}
    <li>{{ message }}</li>
  {% endfor %}
</ul>

<div class="main_content_div">
  <div class="opmerking_info">
    <div class="title"><p>Opmerkingen maken op het PvE</p></div>
    <div class="content"><p>Maak hier uw opmerkingen op alle items op het PvE. Een item kan voldoen aan de eisen, of u kan een opmerking hebben op het item, met daarbij extra kosten geven, of juist minder kosten geven (minteken toevoegen voor de prijs). Een item is genoteerd als 'verwerkt' als 'voldoet' is aangeklikt, Ã³f een opmerking is toegevoegd als hij niet voldoet. Als u over alle items gegaan ben is er een mogelijkheid om de opmerkingen te 'freezen', de projectmanager wordt genotificeerd voor volgende acties, en kunt u geen opmerkingen meer maken of bewerken. U kunt uw voortgang altijd opslaan en later weer terugkomen.</p></div>
  </div>
</div>
{% if items %}


<div class="item_opmerking_list">

{% for hoofdstuk, one_deep in hoofdstuk_ordered_items.items %}
    <button type="button" class="hoofdstuk">{{ hoofdstuk.hoofdstuk }} <img class="arrow-down" src="{% static 'syntrus/svg/ArrowDown.svg' %}"></img><img class="arrow-up" src="{% static 'syntrus/svg/ArrowUp.svg' %}"></img></button>
    <div class="hoofdstuk_content">
    {% if one_deep.items %}
        {% for paragraaf, items in one_deep.items %}
            <button type="button" class="paragraaf">{{ paragraaf.paragraaf }} <img class="arrow-down" src="{% static 'syntrus/svg/ArrowDown.svg' %}"></img><img class="arrow-up" src="{% static 'syntrus/svg/ArrowUp.svg' %}"></img></button>
            <div class="paragraaf_content">
                {% for item in items %}
                    <p onClick="document.getElementById('{{ item.id }}').style.display='block'">{{ item.inhoud }}</p>
                {% endfor %}
            </div>
        {% endfor %}
    {% else %}
        {% for item in one_deep %}
        <p onClick="document.getElementById('{{ item.id }}').style.display='block'">{{ item.inhoud }}</p>
        {% endfor %}  
    {% endif %}
    </div>
{% endfor %}
</div>
<div class="opmerking_form_modal">
        {% for form in forms %}
            <div id="{{ form.item_id.value }}" class="w3-modal">
                <div class="w3-modal-content">
                    <div class="w3-container">
                        <input class="item-id" name="item_id" type="number" value="{{ form.item_id.value }}">
                        <label class="item_label">Item:</label>
                        <p class="inhoud">{{ items|index:forloop.counter0|slice:":100" }}</p>
                        <label for="{{ form.voldoet.id_for_label }}">Voldoet:</label>
                        <p class="checkbox"><input type="checkbox" name="voldoet" id="id_voldoet" value="{{ form.item_id.value }}"></p>
                        <label for="{{ form.annotation.id_for_label }}">Opmerking:</label>
                        <p class="formbox">{{ form.annotation }}</p>
                        <label for="{{ form.kostenConsequenties.id_for_label }}">Kostenverschil:</label>
                        <p class="formbox">{{ form.kostenConsequenties }}</p>                    
                        <label for="{{ form.annbijlage.id_for_label }}">Bijlage:</label>
                        <p class="formbox">{{ form.annbijlage }}</p>

                        <span class="form_buttons">
                          <div onclick="document.getElementById('{{ form_item_ids|previous_one:forloop.counter0 }}').style.display='block'; document.getElementById('{{ form.item_id.value }}').style.display='none'" class="done_button left"><p>< Vorige</p></div>
                          <div onclick="document.getElementById('{{ form.item_id.value }}').style.display='none'" class="done_button center"><p>Gereed</p></div>
                          <div onclick="document.getElementById('{{ form_item_ids|next_one:forloop.counter0 }}').style.display='block'; document.getElementById('{{ form.item_id.value }}').style.display='none'" class="done_button right"><p>Volgende ></p></div>
                        </span>
                    </div>
                </div>
            </div>
        {% endfor %}

</div>
{% else %}
<p>Nog geen PVE gekoppeld aan dit project.</p>
{% endif %}
</form>
{% endblock %}

{% block scripts %}
<script>
var coll = document.getElementsByClassName("hoofdstuk");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}

var coll2 = document.getElementsByClassName("paragraaf");
var i;

for (i = 0; i < coll2.length; i++) {
  coll2[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}

$('.leavecomment').click(function(e){
      e.preventDefault();
      $(this).next().show();
});


</script>
{% endblock %}